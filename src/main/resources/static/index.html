<!--<!DOCTYPE html>-->
<!--<html>-->
<!--<head>-->
<!--    <title>WebSocket Test</title>-->
<!--    <meta charset="UTF-8">-->
<!--    <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.5.1/sockjs.min.js"></script>-->
<!--    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>-->
<!--    <script src="https://cdnjs.cloudflare.com/ajax/libs/uuid/8.3.2/uuid.min.js"></script>-->

<!--    <script>-->
<!--        var stompClient = null;-->

<!--        function connect() {-->
<!--            var language = document.getElementById('language').value;-->
<!--            var random = Math.random(15) * 100000000000000000;-->
<!--            var socket = new SockJS('http://localhost:8080/ws');-->
<!--            stompClient = Stomp.over(socket);-->
<!--            var headers = { "language": language, "path": random };-->
<!--            stompClient.connect(headers, function (frame) {-->
<!--                console.log('Connected: ' + frame);-->
<!--                basicSubscribe(random);-->
<!--            });-->
<!--        }-->

<!--        function basicSubscribe(random) {-->
<!--            var url = '/topic/test/' + random;-->
<!--            stompClient.subscribe(url, function (random) {-->
<!--                console.log('complete subscribe = ' + url + ' : ' + random.body);-->
<!--            });-->
<!--        }-->

<!--        function disconnect() {-->
<!--            if (stompClient !== null) {-->
<!--                stompClient.disconnect();-->
<!--                console.log('Disconnected');-->
<!--            }-->
<!--        }-->

<!--        function subscribe() {-->
<!--            var url = document.getElementById('subscribe-url').value;-->
<!--            stompClient.subscribe(url, function (message) {-->
<!--                console.log('Received message from ' + url + ': ' + message.body);-->
<!--                // Perform any additional actions with the received message here-->
<!--            });-->
<!--        }-->

<!--        function publish() {-->
<!--            var url = document.getElementById('publish-url').value;-->
<!--            var message = document.getElementById('publish-message').value;-->
<!--            stompClient.send(url, {}, message);-->
<!--            console.log('Published message to ' + url + ': ' + message);-->
<!--        }-->

<!--        // 삭제되었습니다-->

<!--    </script>-->
<!--</head>-->
<!--<body>-->
<!--<h1>WebSocket Test</h1>-->
<!--<p>Check the browser console for incoming messages.</p>-->

<!--&lt;!&ndash; 추가된 부분: 입력 언어 받아오기 &ndash;&gt;-->
<!--<h2>Enter Language:</h2>-->
<!--<select id="language">-->
<!--    <option value="KOREAN">KOREAN</option>-->
<!--    <option value="ENGLISH">ENGLISH</option>-->
<!--</select>-->

<!--&lt;!&ndash; 추가된 부분: 매칭 탐색 버튼 &ndash;&gt;-->
<!--<button onclick="connect()">매칭 탐색</button>-->

<!--<h2>Subscribe to URL:</h2>-->
<!--<input type="text" id="subscribe-url" placeholder="Enter URL to subscribe" />-->
<!--<button onclick="subscribe()">Subscribe</button>-->

<!--<h2>Publish Message:</h2>-->
<!--<input type="text" id="publish-url" placeholder="Enter URL to publish" />-->
<!--<input type="text" id="publish-message" placeholder="Enter message to publish" />-->
<!--<button onclick="publish()">Publish</button>-->

<!--</body>-->
<!--</html>-->

<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>WebSocket Test</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.5.1/sockjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/uuid/8.3.2/uuid.min.js"></script>
    <script>
        var stompClient = null;

        function connect() {
            // let random = Math.random(15) * 1000000000000000000;
            // let userLanguage = document.getElementById('userLanguage').value;
            // let targetLanguage = document.getElementById('targetLanguage').value;
            // let userId = document.getElementById('userId').value;
            let socket = new SockJS('http://localhost:8080/ws');
            stompClient = Stomp.over(socket);
            let headers = {"Authorization": "token"};
            stompClient.connect(headers, function () {
                console.log("커넥트 완료")
                basicSubscribe();
            });
        }

        function basicSubscribe() {
            let random = Math.random(15) * 1000000000000000000;
            let url = '/match/' + random;
            console.log("구독 시작. 목표 endpoint = " + url)
            stompClient.subscribe(url, onMessageReceived, {"authorization": "token"});
            console.log("구독 완료.")
            checkMatch(random);

        }

        function checkMatch(random) {
            let userLanguage = document.getElementById('userLanguage').value;
            let targetLanguage = document.getElementById('targetLanguage').value;
            let userId = document.getElementById('userId').value;
            let headers = {"Authorization" : "token", "userLanguage" : userLanguage, "targetLanguage": targetLanguage, "userId":userId, "path" : random }
            let endpoint = '/request/' + random
            stompClient.send(endpoint, headers, "directMatching check");


        }

        function onMessageReceived(data) {
            if(data.headers.isMatch==="true"){
                let sendurl = '/match/'+ data.headers.path
                let headers = {"Authorization": "token"}
                stompClient.send(sendurl, headers, "안녕? 나는 "+ document.getElementById('userId').value + " 이야!")
            }
        }
        function webRtcMessage(data){
        }
        // function onError(error) {
        //     console.log("onError 발동");
        // }


        function disconnect() {
            if (stompClient !== null) {
                stompClient.disconnect(defaultCallback,{"userId" : document.getElementById('userId').value});
            }
        }
        function defaultCallback(){
            console.log('Disconnect완료')
        }
        //
        // function subscribe() {
        //     let url = document.getElementById('subscribe-url').value;
        //     stompClient.subscribe(url, function (message) {
        //         console.log('Received message from ' + url + ': ' + message.body);
        //         // Perform any additional actions with the received message here
        //     });
        // }
        //
        // function unsubscribe() {
        //     let url = document.getElementById('unsubscribe-url').value;
        //     stompClient.unsubscribe(url);
        //     console.log('Unsubscribed from ' + url);
        // }
        //
        // function publish() {
        //     var url = document.getElementById('publish-url').value;
        //     var message = document.getElementById('publish-message').value;
        //     stompClient.send(url, {}, message);
        // }
    </script>
</head>
<body>
<h1>WebSocket Test</h1>
<p>Check the browser console for incoming messages.</p>
<h2>YourID:</h2>
<input type="text" id="userId" placeholder="input your ID"/>
<h2>Enter Your Language: </h2>
<select id="userLanguage">
    <option value="KOREAN">KOREAN</option>
    <option value="ENGLISH">ENGLISH</option>
</select>
<div></div>
<h2>Enter TargetLanguage: </h2>
<select id="targetLanguage">
    <option value="ENGLISH">ENGLISH</option>
    <option value="KOREAN">KOREAN</option>

</select>
<button onclick="connect()">매칭 탐색</button>

<button onclick="disconnect()">Disconnect</button> <!-- Disconnect 버튼 추가 -->
</body>
</html>