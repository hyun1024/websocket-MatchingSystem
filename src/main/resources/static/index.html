<!--<!DOCTYPE html>-->
<!--<html>-->
<!--<head>-->
<!--    <title>WebSocket Test</title>-->
<!--    <meta charset="UTF-8">-->
<!--    <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.5.1/sockjs.min.js"></script>-->
<!--    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>-->
<!--    <script src="https://cdnjs.cloudflare.com/ajax/libs/uuid/8.3.2/uuid.min.js"></script>-->

<!--    <script>-->
<!--        var stompClient = null;-->

<!--        function connect() {-->
<!--            var language = document.getElementById('language').value;-->
<!--            var random = Math.random(15) * 100000000000000000;-->
<!--            var socket = new SockJS('http://localhost:8080/ws');-->
<!--            stompClient = Stomp.over(socket);-->
<!--            var headers = { "language": language, "path": random };-->
<!--            stompClient.connect(headers, function (frame) {-->
<!--                console.log('Connected: ' + frame);-->
<!--                basicSubscribe(random);-->
<!--            });-->
<!--        }-->

<!--        function basicSubscribe(random) {-->
<!--            var url = '/topic/test/' + random;-->
<!--            stompClient.subscribe(url, function (random) {-->
<!--                console.log('complete subscribe = ' + url + ' : ' + random.body);-->
<!--            });-->
<!--        }-->

<!--        function disconnect() {-->
<!--            if (stompClient !== null) {-->
<!--                stompClient.disconnect();-->
<!--                console.log('Disconnected');-->
<!--            }-->
<!--        }-->

<!--        function subscribe() {-->
<!--            var url = document.getElementById('subscribe-url').value;-->
<!--            stompClient.subscribe(url, function (message) {-->
<!--                console.log('Received message from ' + url + ': ' + message.body);-->
<!--                // Perform any additional actions with the received message here-->
<!--            });-->
<!--        }-->

<!--        function publish() {-->
<!--            var url = document.getElementById('publish-url').value;-->
<!--            var message = document.getElementById('publish-message').value;-->
<!--            stompClient.send(url, {}, message);-->
<!--            console.log('Published message to ' + url + ': ' + message);-->
<!--        }-->

<!--        // 삭제되었습니다-->

<!--    </script>-->
<!--</head>-->
<!--<body>-->
<!--<h1>WebSocket Test</h1>-->
<!--<p>Check the browser console for incoming messages.</p>-->

<!--&lt;!&ndash; 추가된 부분: 입력 언어 받아오기 &ndash;&gt;-->
<!--<h2>Enter Language:</h2>-->
<!--<select id="language">-->
<!--    <option value="KOREAN">KOREAN</option>-->
<!--    <option value="ENGLISH">ENGLISH</option>-->
<!--</select>-->

<!--&lt;!&ndash; 추가된 부분: 매칭 탐색 버튼 &ndash;&gt;-->
<!--<button onclick="connect()">매칭 탐색</button>-->

<!--<h2>Subscribe to URL:</h2>-->
<!--<input type="text" id="subscribe-url" placeholder="Enter URL to subscribe" />-->
<!--<button onclick="subscribe()">Subscribe</button>-->

<!--<h2>Publish Message:</h2>-->
<!--<input type="text" id="publish-url" placeholder="Enter URL to publish" />-->
<!--<input type="text" id="publish-message" placeholder="Enter message to publish" />-->
<!--<button onclick="publish()">Publish</button>-->

<!--</body>-->
<!--</html>-->

<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>WebSocket Test</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.5.1/sockjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/uuid/8.3.2/uuid.min.js"></script>
    <script>
        var stompClient = null;

        function connect() {
            let language = document.getElementById('language').value;
            let random = Math.random(15) * 100000000000000000;
            let socket = new SockJS('http://localhost:8080/ws');
            stompClient = Stomp.over(socket);
            let headers = {"language": language, "path": random};
            stompClient.connect(headers, function () {
                console.log("커넥트 완료")
                basicSubscribe(random);
            });
        }

        function basicSubscribe(random) {
            let url = '/match/' + random;
            console.log("구독 시작. 목표 endpoint = " + url)
            stompClient.subscribe(url, onMessageReceived, {authorization: "token"});
            checkDirectMatch(random);

        }

        function checkDirectMatch(random) {
            let sendurl = '/request/' + random
            stompClient.send(sendurl, {}, "directMatching check");


        }

        function onMessageReceived(data) {
            if(data.headers.isMatch==="true"){
                stompClient.subscribe('/match/'+data.body, webRtcMessage, {authorization: "token"});
            }
        }
        function webRtcMessage(data){
        }
        function onError(error) {
            console.log("onError 발동");
        }


        function disconnect() {
            if (stompClient !== null) {
                stompClient.disconnect();
                console.log('Disconnected');
            }
        }

        function subscribe() {
            let url = document.getElementById('subscribe-url').value;
            stompClient.subscribe(url, function (message) {
                console.log('Received message from ' + url + ': ' + message.body);
                // Perform any additional actions with the received message here
            });
        }

        function unsubscribe() {
            let url = document.getElementById('unsubscribe-url').value;
            stompClient.unsubscribe(url);
            console.log('Unsubscribed from ' + url);
        }

        function publish() {
            var url = document.getElementById('publish-url').value;
            var message = document.getElementById('publish-message').value;
            stompClient.send(url, {}, message);
        }
    </script>
</head>
<body>
<h1>WebSocket Test</h1>
<p>Check the browser console for incoming messages.</p>

<h2>Subscribe to URL:</h2>
<input type="text" id="subscribe-url" placeholder="Enter URL to subscribe"/>
<button onclick="subscribe()">Subscribe</button>

<h2>Publish Message:</h2>
<input type="text" id="publish-url" placeholder="Enter URL to publish"/>
<input type="text" id="publish-message" placeholder="Enter message to publish"/>
<button onclick="publish()">Publish</button>

<h2>Enter Language:</h2>
<select id="language">
    <option value="KOREAN">KOREAN</option>
    <option value="ENGLISH">ENGLISH</option>
</select>

<button onclick="connect()">매칭 탐색</button>
<button onclick="disconnect()">Disconnect</button> <!-- Disconnect 버튼 추가 -->

<h2>Unsubscribe from URL:</h2>
<input type="text" id="unsubscribe-url" placeholder="Enter URL to unsubscribe"/>
<button onclick="unsubscribe()">Unsubscribe</button> <!-- Unsubscribe 버튼 추가 -->

</body>
</html>